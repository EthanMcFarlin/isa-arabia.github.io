<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Isa Arabia | Photography</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
  <link href="css/projects.css" rel="stylesheet">
  <link href="css/styles.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/css/bootstrap.min.css" rel="stylesheet">

  <!-- Include Font Awesome for the close button -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

  <style>
    #popupOverlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .popup {
      max-width: 90vw; /* Slightly wider than the image */
      max-height: 90vh;
      background: white;
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
    }

    .popup img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }

    .close-button {
      position: absolute;
      top: 25px; /* Increased from 10px to 25px */
      right: 25px; /* Increased from 10px to 25px */
      color: #fff;
      cursor: pointer;
      font-size: 24px;
      z-index: 1001;
    }
  </style>
</head>

<body id="projectsBody">

<div id="fakeContainer">
  <nav>
    <ul class="nav-bar">
      <li><a href="" class="unselected">cv</a></li>
      <li><a href="#about" class="unselected">science</a></li>
      <li><a href="projects.html">art</a></li>
      <li><a href="#contact" class="unselected">contact</a></li>
      <li><a href="index.html" id="specialText">ISA</a></li>
    </ul>
  </nav>
</div>

<div id="sketchContainer2"></div>

<!-- Popup element -->
<div id="popupOverlay">
  <div class="popup">
    <i class="fas fa-times close-button" onclick="closePopup(event)"></i>
    <img id="popupImage" src="" alt="Larger version">
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/p5@1.11.0/lib/p5.min.js"></script>

<script>
  let columns;
  let images = [];
  const numImages = 14;
  let columnHeights = [0, 0, 0];
  const margin = 20; // Margin in pixels for both horizontal and vertical spacing
  let imgWidth;
  let popupOpen = false; // To track if the popup is open

  function preload() {
    for (let i = 1; i <= numImages; i++) {
      images.push(loadImage(`img/photo/photo_${i}.png`));
    }
  }

  function setup() {
    const containerWidth = document.getElementById('sketchContainer2').offsetWidth;
    const availableWidth = containerWidth - 2 * margin;
    imgWidth = availableWidth / 3;

    columns = [[], [], []];

    images.forEach((img, index) => {
      img.resize(imgWidth, 0);

      const shortestColumn = columnHeights.indexOf(Math.min(...columnHeights));
      columns[shortestColumn].push({ img, originalIndex: index + 1 });
      columnHeights[shortestColumn] += img.height + margin;
    });

    const totalHeight = Math.max(...columnHeights) + margin;

    createCanvas(containerWidth, totalHeight).parent('sketchContainer2');
  }

  function draw() {
    background('#090E1E');

    let xOffset = margin / 2;
    for (let columnIndex = 0; columnIndex < columns.length; columnIndex++) {
      let yOffset = margin / 2;
      columns[columnIndex].forEach(({ img, originalIndex }) => {
        image(img, xOffset, yOffset);

        if (
                mouseX > xOffset &&
                mouseX < xOffset + img.width &&
                mouseY > yOffset &&
                mouseY < yOffset + img.height
        ) {
          cursor(HAND);
          if (mouseIsPressed && !popupOpen) openPopup(originalIndex);
        }

        yOffset += img.height + margin;
      });
      xOffset += imgWidth + margin;
    }

    let cursorSet = false;
    xOffset = margin / 2;
    for (let i = 0; i < columns.length; i++) {
      let yOffset = margin / 2;
      columns[i].forEach(({ img }) => {
        if (
                mouseX > xOffset &&
                mouseX < xOffset + img.width &&
                mouseY > yOffset &&
                mouseY < yOffset + img.height
        ) {
          cursorSet = true;
        }
        yOffset += img.height + margin;
      });
      xOffset += imgWidth + margin;
    }
    if (!cursorSet) {
      cursor(ARROW);
    }
  }

  function openPopup(originalIndex) {
    popupOpen = true; // Set flag to prevent reopening
    const popupOverlay = document.getElementById('popupOverlay');
    const popupImage = document.getElementById('popupImage');

    popupImage.src = `img/photo/photo_${originalIndex}.png`;
    popupOverlay.style.display = 'flex';
  }

  function closePopup(event) {
    event.stopPropagation(); // Prevent event from propagating to other click events
    popupOpen = false; // Reset flag to allow reopening
    document.getElementById('popupOverlay').style.display = 'none';
  }
</script>

</body>
</html>